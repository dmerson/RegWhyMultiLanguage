(function(){var conversant=window.conversant={};var jil=conversant.jil={responses:{supports:{}},logging:false};var clickTagDescriptor={set:function(val){if(!this.value||conversant.jil.clickTag&&conversant.jil.clickTag!==this.value){this.value=val;sendMessage(JSON.stringify({action:"notification",payload:{clickTagSetTo:val}}));log("Set clickTag to "+val)}},get:function(){return this.value}};Object.defineProperty(window,"clickTag",clickTagDescriptor);Object.defineProperty(window,"clickTAG",clickTagDescriptor);var init=function(){log("init() called.");parseHash();overloadWindowOpen();sendMessage('{"action":"sync"}')};var log=function(txt,obj){if(conversant.jil.logging){console.log("[Client] "+txt);if(typeof obj==="object"){console.dir(obj)}}};var parseHash=function(){var hash=document.location.hash.replace(/^#/,"");if(hash){log("Got hash. Parsing...");var obj=JSON.parse(decodeURIComponent(hash));log("Parsed object from URL hash:",obj);for(var key in obj){if(obj.hasOwnProperty(key)){conversant.jil[key]=obj[key]}}sync(obj)}if(!!conversant.jil.clickTag){window.clickTag=conversant.jil.clickTag}};var sendMessage=function(msg){log("Sending msg to controller: "+msg);parent.postMessage(msg,"*")};var receiveMessage=function(event){var obj=JSON.parse(event.data);console.log("[Client] Received message: "+event.data);switch(obj.action){case"sync":sync(obj.payload);break;case"event":break;default:}};var sync=function(data){log("Syncing values to creative");for(var key in data){if(data.hasOwnProperty(key)){log("Setting '"+key+"' to "+data[key]);conversant.jil.responses[key]=data[key];if(key==="hasMRAID"&&data[key]===true&&!conversant.jil.mraid){conversant.jil.mraid={loaded:false};loadMRAID()}if(!!conversant.jil.responses.clickTag){window.clickTag=conversant.jil.clickTag=conversant.jil.responses.clickTag}}}};var loadMRAID=function(){if(!conversant.jil.mraid.loaded){var scr=document.createElement("script");scr.src="mraid-bridge.js";document.head.appendChild(scr);conversant.jil.mraid.loaded=true}};var overloadWindowOpen=function(){var originalOpen=window.open;var isiOSWebview=typeof navigator.doNotTrack==="undefined"&&typeof navigator.msDoNotTrack==="undefined"&&typeof window.doNotTrack==="undefined";window.open=function(url,name,features){if(typeof window.mraid!=="undefined"&&typeof window.mraid.open!=="undefined"&&typeof window.mraid.open==="function"&&!window.gwd){log("Overloading window.open with mraid.open to ensure in-app functionality");mraid.open(window.clickTag)}else if(isiOSWebview&&!/CriOS/.test(navigator.userAgent)&&!/FxiOS/.test(navigator.userAgent)&&!/OPiOS/.test(navigator.userAgent)){log("Overloading window.open with anchor click in iOS webview without MRAID");var anchor=document.createElement("a");anchor.href=window.clickTag;document.body.append(anchor);anchor.click();document.body.removeChild(anchor)}else{originalOpen.call(window,window.clickTag,name,features)}}};init();window.addEventListener("message",receiveMessage,false)})();
