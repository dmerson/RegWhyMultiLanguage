(function(){window.conversant=window.conversant||{};window.conversant.jil=window.conversant.jil||{};var cc=window.conversant.jil.controller={};window.conversant.jil.controller.init=function(obj,callback){window.conversant.jil.controller.config=obj;cc.notifications=[];displayAd(callback)};var log=function(txt,obj){if(cc.config.logging){console.log("[JIL CONTROLLER] "+txt);if(typeof obj==="object"){console.dir(obj)}}};var displayAd=window.conversant.jil.controller.displayAd=function(callback){log("displayAd fired.");var adWrapper=document.getElementById(cc.config.container);if(!adWrapper){adWrapper=document.createElement("div");adWrapper.id=cc.config.container;adWrapper.style.height=cc.config.height+"px";adWrapper.style.width=cc.config.width+"px";var where=!document.currentScript?document.body:document.currentScript.parentElement;where.insertBefore(adWrapper,document.currentScript)}var ctag=encodeURIComponent(JSON.stringify({clickTag:cc.config.clickTag,hasMRAID:hasMRAID()}));if(adWrapper.tagName==="DIV"){var adIframe=cc.config.iframe=document.createElement("iframe");adIframe.style.border="none";adIframe.style.height=adWrapper.style.height=cc.config.size.height+"px";adIframe.style.width=adWrapper.style.width=cc.config.size.width+"px";adIframe.width=parseInt(cc.config.size.width);adIframe.height=parseInt(cc.config.size.height);if(callback)adIframe.onload=callback;adIframe.src=cc.config.actualURL=cc.config.adURL+"#"+ctag;adWrapper.appendChild(adIframe);cc.config.adWrapper=adWrapper;cc.config.adIframe=adIframe}else{var adIframe=cc.config.iframe=adWrapper;adIframe.src=cc.config.adURL=adIframe.src+"#"+ctag;cc.config.adWrapper=adWrapper;cc.config.adIframe=adWrapper}return adIframe};var handleEvent=function(evt){log("handleEvent called:"+evt);sendMessage("event",{eventName:evt})};var receiveMessage=function(event){log("Received message: "+event.data);var obj;try{obj=JSON.parse(event.data)}catch(error){obj={};log("Failed to parse recieved message: Invalid JSON")}if(!obj.type||obj.type!="mraid"){if(obj.action==="sync"){log("Sync requested");sync()}else if(obj.action==="event"||obj.action==="addEventListener"){if(obj.payload.event&&!obj.payload.eventName)obj.payload.eventName=obj.payload.event;document.addEventListener(obj.payload.eventName,handleEvent);log("Added event listener for "+obj.payload.eventName)}else if(obj.action==="notification"){cc.notifications.push(obj.payload);log("Received notification from client:",obj.payload)}else{log("Request to execute: "+obj.action+"("+obj.payload?JSON.stringify(obj.payload):""+")")}}};var sendMessage=function(action,msg){if(typeof msg!=="string"){msg=JSON.stringify(msg)}var fullmsg='{"action": "'+action+'", "payload":'+msg+"}";log("Sending msg: "+fullmsg);cc.config.iframe.contentWindow.postMessage(fullmsg,"*")};var sync=function(items){if(!items){var items=["clickTag","hasMRAID"]}var out={},cnt=items.length,method="";for(var item=0;item<cnt;item++){method=items[item];log("[Controller] Pre-fetching "+method+"()");out[method]=conversant.jil[method]()}sendMessage("sync",out);sendMessage("event",{eventName:"ready"})};var hasMRAID=window.conversant.jil.hasMRAID=function(){return!!(window.mraid||window.MRAID_ENV)};var clickTag=window.conversant.jil.clickTag=function(val){if(val){window.clickTag=conversant.jil.controller.config.clickTag=val}var ctag=window.clickTag||conversant.jil.controller.config.clickTag;return ctag};var loadMRAIDController=function(){var scr=document.createElement("script");scr.src="https://secure.cdn.fastclick.net/js/jil/mraid-controller.js";document.head.appendChild(scr)};if(hasMRAID()){loadMRAIDController()}window.addEventListener("message",receiveMessage,false)})();
